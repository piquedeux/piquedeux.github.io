<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Letztes Bild aus Dropbox</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 40px; }
    img { max-width: 90%; margin-top: 20px; border-radius: 8px; }
    .info { margin-top: 10px; color: #444; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>Letztes Bild</h1>
  <div id="content">Lädt…</div>

  <script>
    const SHARED_FOLDER_URL = "https://www.dropbox.com/scl/fo/icpkdzmyrbwonrlupe0gg/AK2z1VISUqQea4V6VbWyAEc?rlkey=csk78456eeragqd8nxdlyi0xa&st=nqv5jodj&dl=0";

    async function loadLatest() {
      try {
        // 1. HTML vom geteilten Ordner laden
        const res = await fetch(SHARED_FOLDER_URL);
        const text = await res.text();

        // 2. Alle Bild-Links finden (.jpg, .png, .jpeg, .gif)
        const regex = /https:\/\/www\.dropbox\.com\/s\/[^"]+\.(jpg|jpeg|png|gif)\?dl=0/g;
        const matches = text.match(regex);

        if (!matches || matches.length === 0) {
          document.getElementById("content").innerText = "Keine Bilder gefunden.";
          return;
        }

        // 3. In RAW-Links umwandeln
        const rawLinks = matches.map(link => link.replace("?dl=0", "?raw=1"));

        // 4. Sortierung nach Zahl im Dateinamen
        rawLinks.sort((a, b) => {
          const numA = parseInt(a.match(/(\d+)(?=\.\w+\?raw=1)/)?.[0] || "0", 10);
          const numB = parseInt(b.match(/(\d+)(?=\.\w+\?raw=1)/)?.[0] || "0", 10);
          return numA - numB; // klein -> groß
        });

        // 5. Letztes (höchste Zahl = neuestes)
        const latest = rawLinks[rawLinks.length - 1];
        const filename = latest.split("/").pop().split("?")[0];

        // 6. Anzeige
        document.getElementById("content").innerHTML = `
          <img src="${latest}" alt="">
          <div class="info">${filename}</div>
        `;
      } catch (e) {
        document.getElementById("content").innerText = "Fehler beim Laden: " + e;
      }
    }

    loadLatest();
  </script>
</body>
</html>