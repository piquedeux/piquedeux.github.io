<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Piquedeux App Archive</title>

<style>

body {
font-family: serif;
}

a {
color: black;
}

.subfolder {
    display: none; 
    list-style: none;
    padding-left: 20px;
}

.folder-item.open > .subfolder {
    display: block; 
}

.folder-icon {
    cursor: pointer;
    user-select: none;
}

.description {
    font-size: 0.8em;
    color: #666;
    margin-left: 10px;
}
</style>

</head>
<body>
  <div id="container">
    <header>
      <h1>â™ â™  App Archive</h1>
      <h2>by <a href="https://moritzgauss.com">Moritz Gauss</a></h2>
    </header>
    <main>
      <ul class="folder">
        <li class="folder-item">
          <span class="folder-icon">ğŸ“ git.piquedeux.de/</span>
          <ul class="subfolder">
            <!-- dynamisch -->
          </ul>
        </li>
      </ul>
    </main>
  </div>

  <script> 
document.addEventListener("DOMContentLoaded", () => {
    const repoSuffix = ".app";
    const subfolder = document.querySelector(".subfolder");
    const githubUser = "piquedeux"; 


    document.addEventListener("click", (e) => {
        if (e.target.classList.contains("folder-icon")) {
            const parent = e.target.closest("li");
            if (!parent) return;

            const targetSubfolder = parent.querySelector("ul");
            if (targetSubfolder) {
                const isOpen = parent.classList.toggle("open");
                targetSubfolder.style.display = isOpen ? "block" : "none";
                

                const iconText = e.target.textContent;
                if (isOpen) {
                    e.target.textContent = iconText.replace("ğŸ“", "ğŸ“‚");
                } else {
                    e.target.textContent = iconText.replace("ğŸ“‚", "ğŸ“");
                }
            }
        }
    });

    async function fetchRepos() {
        if (!subfolder) return;
        subfolder.innerHTML = "<li>Lade Archive...</li>";

        try {
            const response = await fetch(`https://api.github.com/users/${githubUser}/repos?sort=created`);
            if (!response.ok) throw new Error("API-Limit erreicht oder User nicht gefunden");

            const repos = await response.json();


            const filtered = repos
                .filter(repo => 
                    !repo.private && 
                    repo.name.toLowerCase().endsWith(repoSuffix.toLowerCase())
                )
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

            subfolder.innerHTML = ""; // Loader entfernen

            if (filtered.length === 0) {
                subfolder.innerHTML = "<li>Keine .app Repositories gefunden.</li>";
                return;
            }

            filtered.forEach(repo => {
                const createdAt = new Date(repo.created_at);
                const month = String(createdAt.getMonth() + 1).padStart(2, "0");
                const year = createdAt.getFullYear();
                

                const githubPagesUrl = `https://${githubUser}.github.io/${repo.name}/`;

                const li = document.createElement("li");
                li.innerHTML = `
                    <span class="folder-icon" style="cursor:pointer">ğŸ“</span>
                    <a href="${githubPagesUrl}" target="_blank">${repo.name}</a>
                    <span class="description" style="color: #888; font-size: 0.85em; margin-left: 8px;">
                        (${month}/${year})
                    </span>
                `;
                subfolder.appendChild(li);
            });
        } catch (error) {
            console.error("Fehler:", error);
            subfolder.innerHTML = "<li>Fehler beim Laden der Repos von GitHub.</li>";
        }
    }

    fetchRepos();
});

  </script>
</body>
</html>
